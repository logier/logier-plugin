import plugin from '../../lib/plugins/plugin.js'
export class newcomer extends plugin {
  constructor () {
    super({
      name: '欢迎新人',
      dsc: '新人入群欢迎',
      /** https://oicqjs.github.io/oicq/#events */
      event: 'notice.group.increase',
      priority: 5000
    })
  }

  /** 接受到消息都会执行一次 */
  async accept (e) {
    /** 定义入群欢迎内容 */
    
    /** 冷却cd 30s */
    let cd = 30

    logger.info('this.e.user_id' + this.e.user_id)
    logger.info('this.e.bot.uin' + this.e.bot.uin)

    if (this.e.user_id == this.e.bot.uin) return

    /** cd */
    let key = `Yz:newcomers:${this.e.group_id}`
    logger.info('key' + key)
    if (await redis.get(key)) return
    redis.set(key, '1', { EX: cd })

    let mmap = await e.group.getMemberMap();
    let memberId = this.e.at !== undefined ? this.e.at : e.user_id;
    let memberInfo = mmap.get(memberId);
    logger.info('memberInfo' + memberInfo)

    let randomIndex = Math.floor(Math.random() * welcome.length); // 选择一个随机的欢迎消息
    logger.info('randomIndex' + randomIndex)
    let msg = welcome[randomIndex].replace("{0}", memberInfo.nickname); // 将{0}替换为成员的昵称
    logger.info('msg' + msg)

    /** 回复 */
    await this.reply([
      segment.at(this.e.user_id),
      segment.image(`https://q1.qlogo.cn/g?b=qq&s=0&nk=${memberInfo.user_id}`),
      msg
    ])
  }
}

export class outNotice extends plugin {
  constructor () {
    super({
      name: '退群通知',
      dsc: 'xx退群了',
      event: 'notice.group.decrease'
    })

    /** 退群提示词 */
    this.tips = '退群了'
  }

  async accept () {
    if (this.e.user_id == this.e.bot.uin) return

    let name, msg
    if (this.e.member) {
      name = this.e.member.card || this.e.member.nickname
    }

    if (name) {
      msg = `${name}(${this.e.user_id}) ${this.tips}`
    } else {
      msg = `${this.e.user_id} ${this.tips}`
    }
    logger.mark(`[退出通知]${this.e.logText} ${msg}`)
    await this.reply(msg)
  }
}


var welcome = [
  "  {0} 宁愿上战场，也不愿意在沙滩上晒太阳",
  "  {0} 倒在地上，双眼反射出诡异的光",
  "  {0}，致远星战况如何？",
  "  此乃佛门净地，{0} 也敢私闯？大威天龙！世尊地藏！般若诸佛！般若巴麻空！ ",
  "  {0} 要爆炸了！快跑！",
  "  {0} 进入了频道 他出了一个名刀司命！",
  "  看看，这里有一个新人 {0}",
  "  {0} 加入了我们！Level UP！",
  "  {0} 裤衩！一下冲了出来 偶买噶的！",
  "  我们刚刚见证了 {0} 加入了我们光荣的战团！",
  "  铁头娃成员 {0} 带着他的小姨子来了！",
  "  {0} 进入了频道，他还会变形！它变成了一个...马桶...",
  "  三年二班 {0} 同学！你妈妈拿了两罐开黑牛奶！要给你！",
  "  {0} 可以在表演一次那个吗？",
  "  {0} 进入了频道 快看他那坚毅的眼神，厚实的护甲，硕大的头！",
  "  欢迎 {0} 有朋自远方来，不亦说乎！",
  "  {0}！就是你把鬼子引到这儿来的？",
  "  是谁？有那广阔的胸怀？是谁？站在那高耸的山峰上？是 {0}！",
  "  {0} 应该在车底~不应该在车里~",
  "  来了个新人，{0}，大家快来欺负他！",
  "  欢迎 {0} 进入频道！是什么风把你吹来了？",
  "  {0} 迷失了心智，堕入了原力的黑暗面...",
  "  {0} 是一个真正的大师，他永远怀着一颗学徒的心",
  "  欢迎 {0} 进入频道！是什么让我们在此相遇？",
  "  {0} 踏着七彩祥云来取你的狗命了！",
  "  {0} 进入了这个灰暗的世界，赞美太阳！",
  "  这个频道又多了一个成员！怎么想都是 {0} 的错！",
  "  告诉你的父亲，亲爱的 {0}，准备好迎接出乎意料的结果吧...",
  "  野生的 {0} 出现了！",
  "  新成员揭开了神秘的面具，原来他是 {0}",
  "  {0} 进入了频道 过度的索取终究会带来灭亡...",
  "  {0} 开着他的龙卷风破烂老爷车进入了频道",
  "  {0} 等五名专业人士申请抬着你招摇过市",
  "  {0} 带着黄色眼镜进入了频道，他看什么都是黄色的",
  "  也许正义会迟到，但 {0} 不会缺席",
  "  给老子爬起来！{0}！让我们把这城市烧成灰！",
  "  欢迎回来 {0}，但是我们刚刚弄丢了你的游戏存档...",
  "  {0} 进入了频道 他受到了召唤，他必须回应",
  "  {0}！快看看我！我是黄瓜瑞克！",
  "  待到山花烂漫时，{0} 在丛中笑",
  "  {0} 连宇宙的边缘都不知道在哪儿，怎么会晓得这个",
  "  三年之后又三年，三年之后又三年，都快十年了 {0}！",
  "  电闪雷鸣风雨交加， {0} 降临了！",
  "  也许月球会和我们渐行渐远，但是 {0} 来到了我们身边",
  "  {0} 双脚离地了，聪明的智商又占领高地了！",
  "  {0} 来了，一个向往太阳的灵魂重新回归了怀抱",
  "  嘻唰唰，嘻唰唰，欢迎 {0}！",
  "  {0} 刚从5000年的长眠中醒来，该让这些人知道谁才是他们皇帝了",
  "  {0} ~队长~皇军托我给您带个话~",
  "  {0}！快按F致意你个小兔崽子！",
  "  {0} 1000-7等于几？",
  "  你迟到了！时间就是金钱！我的 {0}！",
  "  快看，这是一种叫做 {0} 的地球生物",
  "  快看看这是谁来了？哦我的上帝啊！是 {0}",
  "  有请新加入的 {0} 给大家整活儿",
  "  你们见过 {0} 了吗？以后他就是我们的人了",
  "  {0} 进入了频道 嘿！有人想要出来和他一较高下吗？",
  "  {0} 发动了引擎，冲出大气层，飞向了宇宙",
  "  欢迎 {0} 进入频道 但是我们已经没有多余的僵立停了...",
  "  {0} 从今天起就是我们的人啦！大家伙给呱唧呱唧！",
  "  {0} 进入了频道 至少...他看上去像是个不错的家伙！",
  "  来了，老弟！{0}，等你好久啦！",
  "  有人来了？看看这是谁！这不是大名鼎鼎的 {0} 嘛！",
  "  在觐见古神之后， {0} 的生活发生了翻天覆地的变化...",
  "  我们的好兄弟，团队的核心 {0} 进入了频道",
  "  吼！没有逃走反而是朝这里走过来了吗？{0}！",
  "  如果上帝为 {0} 关上了一扇门，那么上帝就会让他进入频道",
  "  大河向东流啊~ {0} 参北斗啊~嘿~嘿~参北斗啊~",
  "  当 {0} 凝视深渊的时候，深渊也在凝视着他",
  "  看着 {0} 进入频道，成员们有了一个大胆的想法...",
  "  {0} 来了，有谁见到他的隐形斗篷了吗？",
  "  {0}！何等的不敬！你甚至都不愿意称我一声教父！",
  "  是谁站在飞机上，腰里还别着一串小王八？是 {0}！",
  "  叮！你的提醒开黑小助手 {0} 来啦！准时提醒成员们开黑",
  "  {0} 加入了我们 *你感到充满了决心",
  "  {0} 发出了耀眼的光芒！他进化成了......什么也没有",
  "  {0} 回来了！快让他把浴霸关掉！",
  "  {0}！你！是新的捍卫者！你是新的传奇！",
  "  我轻轻的走了，正如 {0} 轻轻的来",
  "  这个叫 {0} 的少年，体内闪烁着黄金精神",
  "  警告！警告！{0} 灾害浓度五级警告！",
  "  {0} 进入了频道，但事态远没有他想的那么简单",
  "  {0} 两眼是照妖镜~双腿是追风马~乾坤圈~护着他~",
  "  {0} 从餐馆回到了频道，他挺着肚子表示已经吃不下了",
  "  我有一个问题要问 {0}，仿生人会梦见电子羊吗？",
  "  我不演了，我摊牌了， {0} 就是我们新的一员",
  "  {0}！为什么你没做适合手术就可以变身？为什么每次变...（堵嘴）",
  "  游戏结束 {0} 是内鬼！",
  "  你来了！{0} 我还欠你一杯啤酒呢！",
  "  欢迎 {0} 进入频道！要和我一起去捉水母吗？",
  "  欢迎 {0}，你听说过安利吗",
  "  {0} 进入了频道 人若鸿毛，命若野草，卑贱又骄傲",
  "  {0} 进入了频道！是新的朋友！是新的好兄弟！",
  "  欢迎你陌生的 {0} 所有人都想在这个小镇用铅换黄金...",
  "  道频了入进 {0} 迎欢",
  "  {0} 进入了频道 他的到来，让窗外下起了激浪雨",
  "  {0} 先生，很遗憾的告诉你，你刚刚错过了面试...",
  "  {0} 来了，以后这个地盘儿就有了新头儿了！",
  "  欢迎 {0} 进入频道！现在就让快乐的旅程开始吧！",
  "  {0} 进入了频道 吃我一记乌鸦坐飞机！",
  "  {0} 进入了频道 生命...是一种被过分高估的现象...",
  "  {0} 进入了酒馆并向你发起了昆特牌挑战",
  "  {0} 进入了频道，然后他掏出了神奇海螺！",
  "  {0} 进入了频道 欢迎回来，老朋友！",
  "  狂风呼啸 *站在你面前的是 {0}，一个真正的勇士",
  "  时间？真的又到了那个时间了吗？ {0} 先生？",
  "  万众瞩目的 {0} 终于来了，让我们用掌声和热情激烈的欢迎他！",
  "  天空飘来五个字儿~欢迎 {0}！",
  "  我们被延迟劝退了...但是 {0} 进来啦！",
  "  我的名字叫 {0}，是一个普通的上班族...",
  "  欢迎你！在那山的那边海的那边有一个 {0}",
  "  {0} 进入了酒馆并向你发起了昆特牌挑战",
  "  {0} 进入了频道 请各位成员不要在甲板上空中劈叉",
  "  {0} 来了，〃別崇拝哥，哥咫昰個傳裞ぐ~",
  "  {0} 进入了频道！有人想和他来一场PVP吗？",
  "  欢迎 {0} 进入频道 生气了吗？没有哦~",
  "  {0}！你在干什么啊！不要停下来啊！",
  "  欢迎 {0} 来到频道！在火炉旁随便找个位子坐下吧！",
  "  {0} 进入了地牢，一场新的冒险开始了！",
  "  有人进入了频道，就是那个，你知道是谁，就是 {0} ！",
  "  {0} 加入了服务器！",
  "  {0} 曾经也是个勇者，直到他的膝盖中了一箭",
  "  好耀眼！这就是新人 {0} 的光芒吗！？",
  "  只要像这样把生石灰慢慢的倒入水中...啊！{0}！我们等...（boom）",
  "  欢迎 {0} 莅临寒舍，真是金光普照蓬荜生辉呀！",
  "  {0} 进入了频道 我们的空中支援在哪儿？！",
];
